@page "/"

@using blazorServerMentions.Data;
@using blazorServerMentions.Components;

@inject ProfileService ProfileSvc

<PageTitle>Mentions</PageTitle>

<MudContainer  Class="relative" MaxWidth="MaxWidth.Medium">
    <MudText Typo="Typo.h3" GutterBottom="true">How to use it</MudText>

    <MudText Class="mb-8">
        Type <b>@@</b> and start typing some letters for example <b>as</b>
    </MudText>

    <MudAlert Severity="Severity.Normal">
        You can select the member using arrow up <MudIcon Icon="@Icons.Material.Filled.ArrowUpward"></MudIcon>
        and arrow down <MudIcon Icon="@Icons.Material.Filled.ArrowDownward"></MudIcon>.
        You can close the mention box pression <b>Escape</b> or select the user typing <b>Enter</b>
    </MudAlert>

    <div class="mt-8">
        <MentionTextArea T="Profile" Text="@Text" SearchFunc="@SearchFunc">
            <SuggestionContentItem>
                <MudStack Row AlignItems="AlignItems.Center">
                    @if (!string.IsNullOrEmpty(context.Avatar))
                    {
                        <MudAvatar Image="@context.Avatar" Size="Size.Small"></MudAvatar>
                    }
                    else
                    {
                        <MudAvatar Size="Size.Small">
                            <MudIcon Icon="@Icons.Material.Filled.Image" Size="Size.Small"/>
                        </MudAvatar>
                    }

                    <MudText Typo="Typo.body1">
                        @context.Name
                    </MudText>

                    <MudSpacer></MudSpacer>
                    <MudText Typo="Typo.caption">
                        @@@context.Username
                    </MudText>
                </MudStack>
            </SuggestionContentItem>
        </MentionTextArea>
    </div>
</MudContainer>

@code {
    public string? Text { get; set; }

    private async Task<IEnumerable<Profile>?> SearchFunc(string query)
    {
        return await ProfileSvc.GetProfiles(query, limit: 5);
    }
}